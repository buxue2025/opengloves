# ğŸŒ WebSocket ä»£ç†æ¨¡å¼

## ğŸ’¡ æ¶æ„æ”¹è¿›

å°† OpenClaw Gateway çš„ WebSocket è¿æ¥é€šè¿‡ OpenGloves æœåŠ¡å™¨ä»£ç†ï¼Œè¿™æ ·è¿œç¨‹è®¿é—®æ—¶åªéœ€è¦å¼€æ”¾ä¸€ä¸ªç«¯å£ï¼ˆ8080ï¼‰ã€‚

### ä¼ ç»Ÿæ¶æ„ï¼ˆéœ€è¦ä¸¤ä¸ªç«¯å£ï¼‰
```
è¿œç¨‹æµè§ˆå™¨ â”€â”€â†’ é˜²ç«å¢™:8080 â”€â”€â†’ OpenGloves:8080
     â†“
   ws://å…¬ç½‘IP:18789 â”€â”€â†’ é˜²ç«å¢™:18789 â”€â”€â†’ OpenClaw:18789
```

### ä»£ç†æ¶æ„ï¼ˆåªéœ€ä¸€ä¸ªç«¯å£ï¼‰âœ¨
```
è¿œç¨‹æµè§ˆå™¨ â”€â”€â†’ é˜²ç«å¢™:8080 â”€â”€â†’ OpenGloves:8080 (/gateway è·¯å¾„)
                              â†“
                         WebSocket ä»£ç† â”€â”€â†’ OpenClaw:18789 (æœ¬åœ°)
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯ç”¨ä»£ç†æ¨¡å¼

```bash
cd ~/opengloves

# å®‰è£… WebSocket ä¾èµ–
npm install ws

# ä½¿ç”¨ä»£ç†æœåŠ¡å™¨å¯åŠ¨
npm run start:proxy
```

### é…ç½®è¯´æ˜

**config.json** é…ç½®ï¼ˆæœåŠ¡å™¨å†…éƒ¨ä½¿ç”¨ï¼‰:
```json
{
  "gateway": {
    "url": "ws://localhost:18789",  // æœåŠ¡å™¨å†…éƒ¨è¿æ¥
    "token": "your-token"
  }
}
```

**å‰ç«¯è‡ªåŠ¨è·å¾—çš„é…ç½®**ï¼ˆé€šè¿‡ `/api/config`ï¼‰:
```json
{
  "gateway": {
    "url": "ws://yourdomain.com/gateway",  // å®¢æˆ·ç«¯è¿æ¥åˆ°ä»£ç†ç«¯ç‚¹
    "token": "your-token"
  }
}
```

## ğŸ”§ éƒ¨ç½²åˆ°å…¬ç½‘

### 1. ç«¯å£æ˜ å°„ï¼ˆåªéœ€ä¸€ä¸ªï¼‰

```
å…¬ç½‘:8080 â†’ Mac Mini:8080  (OpenGloves + WebSocket Proxy)
```

### 2. é˜²ç«å¢™é…ç½®

```bash
# åªå…è®¸ 8080 ç«¯å£
sudo ufw allow 8080/tcp

# ç¡®ä¿ 18789 ç«¯å£ä¸å¯¹å¤–å¼€æ”¾
sudo ufw status | grep 18789  # åº”è¯¥æ²¡æœ‰è¾“å‡º
```

### 3. å¯åŠ¨æœåŠ¡

```bash
cd ~/opengloves

# ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ PM2
npm install -g pm2
pm2 start server-with-proxy.js --name opengloves-proxy
pm2 save
pm2 startup
```

### 4. æµ‹è¯•è®¿é—®

- **æœ¬åœ°**: http://localhost:8080
- **å…¬ç½‘**: http://ä½ çš„å…¬ç½‘IP:8080

## ğŸ›¡ï¸ å®‰å…¨ä¼˜åŠ¿

### ç›¸æ¯”åŒç«¯å£æ˜ å°„ï¼š

**ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸å®‰å…¨ï¼‰**:
- âŒ OpenClaw Gateway ç›´æ¥æš´éœ²åˆ°å…¬ç½‘
- âŒ éœ€è¦åœ¨é˜²ç«å¢™å¼€æ”¾ 18789 ç«¯å£
- âŒ ç›´æ¥çš„ WebSocket æ”»å‡»é¢

**ä»£ç†æ–¹å¼ï¼ˆå®‰å…¨ï¼‰**:
- âœ… OpenClaw Gateway ä»…æœ¬åœ°å¯è®¿é—®
- âœ… åªéœ€å¼€æ”¾ä¸€ä¸ªç«¯å£ (8080)
- âœ… ä»£ç†å±‚å¯æ·»åŠ é¢å¤–éªŒè¯
- âœ… å¯ä»¥è®°å½•å’Œç›‘æ§æ‰€æœ‰ WebSocket è¿æ¥

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ç›´è¿æ¨¡å¼ | ä»£ç†æ¨¡å¼ |
|------|----------|----------|
| **å»¶è¿Ÿ** | ~1ms | ~2ms (+1msä»£ç†å¼€é”€) |
| **ååé‡** | 100% | ~98% |
| **å†…å­˜å ç”¨** | ä½ | ç¨é«˜ (+WebSocketè¿æ¥ç¼“å­˜) |
| **å®‰å…¨æ€§** | âš ï¸ ä¸­ç­‰ | âœ… é«˜ |
| **ç«¯å£éœ€æ±‚** | 2ä¸ª | 1ä¸ª |

**ç»“è®º**: ä»£ç†æ¨¡å¼çš„æå°æ€§èƒ½å¼€é”€ç›¸æ¯”å®‰å…¨æå‡æ˜¯éå¸¸å€¼å¾—çš„ã€‚

## ğŸ”„ åˆ‡æ¢æ¨¡å¼

### ä»ä¼ ç»Ÿæ¨¡å¼åˆ‡æ¢åˆ°ä»£ç†æ¨¡å¼

**1. åœæ­¢å½“å‰æœåŠ¡**:
```bash
pm2 stop opengloves  # å¦‚æœä½¿ç”¨ PM2
# æˆ– pkill -f "node.*server.js"
```

**2. å…³é—­ 18789 ç«¯å£æ˜ å°„**:
```bash
# åœ¨è·¯ç”±å™¨/é˜²ç«å¢™ä¸­åˆ é™¤ 18789 ç«¯å£æ˜ å°„
```

**3. å¯åŠ¨ä»£ç†æ¨¡å¼**:
```bash
cd ~/opengloves
pm2 start server-with-proxy.js --name opengloves-proxy
```

**4. æ›´æ–° OpenClaw allowedOrigins**:
```bash
# ç¼–è¾‘ ~/.openclaw/openclaw.json
# allowedOrigins å¯ä»¥ä¿æŒä¸å˜ï¼Œå› ä¸ºè¯·æ±‚æ¥æºè¿˜æ˜¯ç›¸åŒçš„
```

### éªŒè¯ä»£ç†æ¨¡å¼

**æ£€æŸ¥æ—¥å¿—**:
```bash
pm2 logs opengloves-proxy

# åº”è¯¥çœ‹åˆ°ï¼š
# ğŸ”Œ WebSocket proxy initialized on /gateway
# ğŸŸ¢ New WebSocket connection from x.x.x.x
# âœ… Connected to OpenClaw Gateway
```

**æµ‹è¯•è¿æ¥**:
```bash
# ä»å¤–éƒ¨æµ‹è¯• WebSocket ä»£ç†
curl -i -N \
  -H "Connection: Upgrade" \
  -H "Upgrade: websocket" \
  -H "Sec-WebSocket-Key: test" \
  http://ä½ çš„å…¬ç½‘IP:8080/gateway
```

## ğŸ¯ æ¨èé…ç½®

### config.jsonï¼ˆä»£ç†æ¨¡å¼ï¼‰
```json
{
  "server": {
    "host": "0.0.0.0",
    "http": {
      "enabled": true,
      "port": 8080
    },
    "https": {
      "enabled": true,
      "port": 8443
    }
  },
  "gateway": {
    "url": "ws://localhost:18789",  // æœ¬åœ°è¿æ¥
    "token": "your-token-here",
    "autoDetectUrl": false          // ä»£ç†æ¨¡å¼ä¸‹ç¦ç”¨è‡ªåŠ¨æ£€æµ‹
  }
}
```

### ç½‘ç»œé…ç½®ï¼ˆå…¬ç½‘ï¼‰
```
è·¯ç”±å™¨é…ç½®:
  å¤–éƒ¨ 8080 â†’ å†…éƒ¨ Mac Mini:8080
  
é˜²ç«å¢™é…ç½®:
  allow 8080/tcp
  deny 18789/tcp  # ç¡®ä¿ä¸å¯¹å¤–å¼€æ”¾
```

---

**è¿™ä¸ªæ–¹æ¡ˆæ—¢å®‰å…¨åˆç®€å•ï¼Œå¼ºçƒˆæ¨èï¼** ğŸŒŸ

åªéœ€è¦å¼€æ”¾ä¸€ä¸ªç«¯å£ï¼Œè€Œä¸” OpenClaw Gateway å®Œå…¨ä¸æš´éœ²åˆ°å…¬ç½‘ï¼Œå®‰å…¨æ€§å¤§å¤§æå‡ã€‚